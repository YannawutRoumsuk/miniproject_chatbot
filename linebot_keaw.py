from flask import Flask, request, abort
from linebot import LineBotApi, WebhookHandler
from linebot.exceptions import InvalidSignatureError
from linebot.models import MessageEvent, TextMessage, TextSendMessage
import os

app = Flask(__name__)

LINE_CHANNEL_ACCESS_TOKEN = "q2plBD0CvtizDgODNzFSG+CwEqgqB91YeSayuU2DQ56rfG5rNzr9nIofa38BOTMdhFx4vc58SLNh+9UXPoUBIRta/aT10i3BXyk98WVdoNr7KwHwl4+lLNlVePk6dG1JccwQP1Sj8m8uHJD7PapXkAdB04t89/1O/w1cDnyilFU="
LINE_CHANNEL_SECRET = "c416f3a07e8c6da7cce101b216b80b2a"

line_bot_api = LineBotApi(LINE_CHANNEL_ACCESS_TOKEN)
handler = WebhookHandler(LINE_CHANNEL_SECRET)

# ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
user_state = {}

# ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Æ‡∏≤‡∏£‡πå‡∏î‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
data = {
    "music": {
        "thai": {
            "top hits": [
                "Rain wedding - Jeff Satur",
                "DAY ONE - PUN",
                "Spring(‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ù‡∏ô) - TheToy, NONTTANONT",
                "‡∏à‡∏î‡∏à‡∏≥ Only Monday",
                "Your Ever ‚Äì Cocktail feat.Q Flure"
            ],
            "tpop": [
                "Situationship ‚Äì 4EVE",
                "LIAR-BUS",
                "WATCH YOUR STEP-BUS",
                "TEEDEE TADA ‚Äì DIAMOND NARAKORN",
                "TRUST ME- LYKN",
                "Get to know me ‚Äì MXFRUIT"
            ],
            "rock band": [
                "Free Fall- Slot Machine",
                "‡∏ü‡∏±‡∏á‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢‡∏á‡πà‡∏≤‡∏¢- Silly fools",
                "‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô - 25hours",
                "‡∏ä‡πà‡∏≤‡∏á‡∏°‡∏±‡∏ô - COCKTAIL",
                "‡∏ô‡∏¥‡∏ó‡∏≤‡∏ô - Musketeers"
            ],
            "folk song": [
                "‡πÅ‡∏Å‡πâ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡πÄ‡∏î‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£ ‚Äì ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏ô‡∏¥‡∏ä",
                "‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏≠‡πà‡∏¢‡∏™‡∏ß‡∏¢‡∏Å‡∏ß‡πà‡∏≤‚Ä¶‡∏ó‡∏∞‡πÄ‡∏• ‚Äì WHATFALSE",
                "‡∏ß‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô‡∏â‡∏±‡∏ô‡πÄ‡∏û‡πâ‡∏≠‡∏ñ‡∏∂‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ò‡∏≠ ‚Äì ‡∏Æ‡∏±‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå",
                "‡∏î‡∏ß‡∏á‡∏î‡∏≤‡∏ß‡πÅ‡∏´‡πà‡∏á‡∏£‡∏±‡∏Å ‚Äì Dr.fuu",
                "‡∏ô‡∏≤‡∏á‡∏á‡∏≤‡∏°‡∏ï‡∏π‡πâ‡∏Å‡∏£‡∏∞‡∏à‡∏Å ‚Äì ‡∏Ñ‡∏≤‡∏£‡∏≤‡∏ö‡∏≤‡∏ß"
            ]
        },
        "china": {
            "c-pop": [
                "Change ‚Äì E.so Áò¶Â≠ê",
                "Focus ‚Äì ÂàòÂÆá",
                "Bad Girl Behave ‚Äì Karencici",
                "Trick or treat ‚Äì AIM",
                "Â∞èÂüéÂ§èÂ§©-LBIÂà©ÊØî"
            ],
            "ost": [
                "Forever StarÔºà„ÄäÂÅ∑ÂÅ∑Ëóè‰∏ç‰Ωè„Äã- ÂºµÊ¥¢Ë±™",
                "Moonlight (ÊúàÂ§ú) - Shuang Sheng, Yao Yang (ÂèåÁ¨ô, Â¶ñÊâ¨)",
                "Upwards to the Moon(Â∑¶ÊâãÊåáÊúà)- Sa DingdingËê®È°∂È°∂",
                "Penannular Love „ÄäÁé¶ÊÅã„Äã- Zhou Shen (Âë®Ê∑±)",
                "Falling You- ÊõæÂèØÂ¶Æ ¬∑ ÈÉΩÊô∫Êñá"
            ],
            "tiktok hits": [
                "ÂÖ®‰∏ñÁïåÈÉΩÂø´‰πêÈô§‰∫ÜÊàëËá™Â∑±-ÊÑâÂø´Ê∂µ&ZenoG",
                "Ê¥õÂ∏åÊ≤°ÊúâÊûÅÈôê ‚Äì XMASwu",
                "Ëµ∑Ëàû- ËâæÁÉ≠",
                "ÁÉ≠Áà±105¬∞ÁöÑ‰Ω†",
                "Â∞ëÂπ¥"
            ]
        }
    },
    "movie": {
        "thai": {
            "animation": [
                "9‡∏®‡∏≤‡∏™‡∏ï‡∏£‡∏≤",
                "The Giant King ‡∏¢‡∏±‡∏Å‡∏©‡πå",
                "‡∏Å‡πâ‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏ß‡∏¢",
                "Echo Planet ‡πÄ‡∏≠‡∏Ñ‡πÇ‡∏Ñ‡πà ‡∏à‡∏¥‡πã‡∏ß‡∏Å‡πâ‡∏≠‡∏á‡πÇ‡∏•‡∏Å",
                "Khun Thong Daeng: The Inspirations ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á"
            ],
            "series": [
                "‡∏ö‡∏∏‡∏û‡πÄ‡∏û‡∏™‡∏±‡∏ô‡∏ô‡∏¥‡∏ß‡∏≤‡∏™",
                "The Gifted",
                "‡πÅ‡∏ô‡∏ô‡πÇ‡∏ô‡πä‡∏∞",
                "‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏Å‡∏≤‡∏°‡πÄ‡∏ó‡∏û",
                "High School Frenemy ‡∏°‡∏¥‡∏ï‡∏£‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏≤‡∏ö‡∏®‡∏±‡∏ï‡∏£‡∏π"
            ],
            "movie": [
                "‡∏ß‡∏¥‡∏°‡∏≤‡∏ô‡∏´‡∏ô‡∏≤‡∏°",
                "‡∏´‡∏•‡∏≤‡∏ô‡∏°‡πà‡∏≤",
                "‡∏â‡∏•‡∏≤‡∏î‡πÄ‡∏Å‡∏°‡∏™‡πå‡πÇ‡∏Å‡∏á",
                "‡∏û‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏û‡∏£‡∏∞‡πÇ‡∏Ç‡∏ô‡∏á",
                "‡πÑ‡∏≠‡∏ü‡∏≤‡∏¢‚Ä¶‡πÅ‡∏ï‡πä‡∏á‡∏Å‡∏¥‡πâ‡∏ß‡πÄ‡∏•‡∏¥‡∏ü‡∏¢‡∏π‡πâ",
                "‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤"
            ]
        },
        "china": {
            "animation": [
                "‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô‡∏à‡∏≠‡∏°‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏†‡∏π‡∏ï‡∏ñ‡∏±‡∏á‡∏ã‡∏≤‡∏ô Soul Land",
                "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏ó‡∏û‡∏≠‡∏™‡∏π‡∏£ Slay the god",
                "‡∏™‡∏±‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏ó‡∏∞‡∏•‡∏∏‡∏ü‡πâ‡∏≤ Fight Break Sphere",
                "‡∏ù‡∏∑‡∏ô‡∏•‡∏¥‡∏Ç‡∏¥‡∏ï‡∏ü‡πâ‡∏≤ ‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô Renegade Immortal",
                "‡∏à‡∏π‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô ‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà‡πÄ‡∏ó‡∏û‡∏™‡∏±‡∏á‡∏´‡∏≤‡∏£ Jade Dynasty"
            ],
            "series": [
                "Hidden love",
                "The UntamedÈôàÊÉÖ‰ª§",
                "Till The End Of The Moon",
                "Put Your Head On My Shoulder",
                "A Love So Beautiful",
                "Who Rules The World"
            ],
            "movie": [
                "One and Only",
                "Monster Hunt",
                "The Battle at Lake Changjin",
                "Wolf Warrior 2",
                "Ne zha",
                "The Wandering Earth"
            ]
        }
    },
    "travel": {
        "thai": {
            "summer": {
                "Bangkok": {
                    "places": [
                        "‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß",
                        "‡∏ß‡∏±‡∏î‡∏≠‡∏£‡∏∏‡∏ì‡∏£‡∏≤‡∏ä‡∏ß‡∏£‡∏≤‡∏£‡∏≤‡∏°‡∏£‡∏≤‡∏ä‡∏ß‡∏£‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏´‡∏≤‡∏£",
                        "‡∏ß‡∏±‡∏î‡∏™‡∏£‡∏∞‡πÄ‡∏Å‡∏®‡∏£‡∏≤‡∏ä‡∏ß‡∏£‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏´‡∏≤‡∏£ (‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏ó‡∏≠‡∏á)",
                        "‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡∏™‡∏ñ‡∏≤‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£",
                        "‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡πâ‡∏≥‡∏Ñ‡∏•‡∏≠‡∏á‡∏•‡∏±‡∏î‡∏°‡∏∞‡∏¢‡∏°"
                    ],
                    "menu": [
                        "‡∏Ç‡πâ‡∏≤‡∏ß‡∏ï‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á",
                        "‡∏ô‡πâ‡∏≥‡∏û‡∏£‡∏¥‡∏Å‡∏•‡∏á‡πÄ‡∏£‡∏∑‡∏≠",
                        "‡πÅ‡∏Å‡∏á‡∏£‡∏±‡∏ç‡∏à‡∏ß‡∏ô",
                        "‡∏Ç‡πâ‡∏≤‡∏ß‡πÅ‡∏ä‡πà‡∏ä‡∏≤‡∏ß‡∏ß‡∏±‡∏á"
                    ]
                },
                "Chonburi": {
                    "places": [
                        "‡∏´‡∏≤‡∏î‡∏ö‡∏≤‡∏á‡πÅ‡∏™‡∏ô",
                        "‡πÄ‡∏Ç‡∏≤‡∏™‡∏≤‡∏°‡∏°‡∏∏‡∏Å",
                        "‡πÄ‡∏Å‡∏≤‡∏∞‡∏•‡πâ‡∏≤‡∏ô (Pattaya)",
                        "‡∏´‡∏≤‡∏î‡∏à‡∏≠‡∏°‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô (Pattaya)",
                        "‡∏´‡∏≤‡∏î‡∏ö‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πà (‡∏™‡∏±‡∏ï‡∏´‡∏µ‡∏ö)",
                        "‡πÄ‡∏Å‡∏≤‡∏∞‡πÅ‡∏™‡∏°‡∏™‡∏≤‡∏£ (‡∏™‡∏±‡∏ï‡∏´‡∏µ‡∏ö)"
                    ],
                    "menu": [
                        "‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏•‡∏≤‡∏°‡∏´‡∏ô‡∏≠‡∏á‡∏°‡∏ô",
                        "‡πÅ‡∏à‡∏á‡∏•‡∏≠‡∏ô",
                        "‡πÑ‡∏Å‡πà‡∏´‡∏∏‡∏ö‡∏ö‡∏≠‡∏ô",
                        "‡∏Ç‡πâ‡∏≤‡∏ß‡πÅ‡∏´‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏î",
                        "‡∏´‡∏°‡∏∂‡∏Å‡πÑ‡∏Ç‡πà‡∏ú‡∏±‡∏î‡∏ô‡πâ‡∏≥‡∏î‡∏≥",
                        "‡∏´‡∏≠‡∏¢‡∏à‡πâ‡∏≠‡∏õ‡∏π"
                    ]
                },
                "Krabi": {
                    "places": [
                        "‡∏≠‡πà‡∏≤‡∏ß‡∏ô‡∏≤‡∏á (Nang Bay)",
                        "‡∏´‡∏≤‡∏î‡∏ô‡∏û‡∏£‡∏±‡∏ï‡∏ô‡πå‡∏ò‡∏≤‡∏£‡∏≤ (Nopparat Thara Beach)",
                        "‡∏´‡∏°‡∏π‡πà‡πÄ‡∏Å‡∏≤‡∏∞‡∏û‡∏µ‡∏û‡∏µ (Phi Phi Islands)"
                    ],
                    "menu": [
                        "‡∏õ‡∏•‡∏≤‡∏à‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á",
                        "‡∏´‡∏≠‡∏¢‡∏ä‡∏±‡∏Å‡∏ï‡∏µ‡∏ô",
                        "‡πÅ‡∏Å‡∏á‡∏™‡πâ‡∏°‡∏õ‡∏•‡∏≤‡∏Å‡∏∞‡∏û‡∏á‡∏¢‡∏≠‡∏î‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß",
                        "‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏π‡πÉ‡∏™‡πà‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î",
                        "‡∏ô‡πâ‡∏≥‡∏û‡∏£‡∏¥‡∏Å‡∏ú‡∏±‡∏Å‡πÄ‡∏´‡∏ô‡∏≤‡∏∞"
                    ]
                }
            },
            "rainy": {
                "Nakhon Nayok": {
                    "places": [
                        "‡∏≠‡∏∏‡∏ó‡∏¢‡∏≤‡∏ô‡∏ß‡∏±‡∏á‡∏ï‡∏∞‡πÑ‡∏Ñ‡∏£‡πâ",
                        "‡πÄ‡∏Ç‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏•‡∏°",
                        "‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏Å‡πà‡∏á‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å",
                        "‡∏ô‡πâ‡∏≥‡∏ï‡∏Å‡∏™‡∏≤‡∏£‡∏¥‡∏Å‡∏≤"
                    ],
                    "menu": [
                        "‡∏ô‡πâ‡∏≥‡∏û‡∏£‡∏¥‡∏Å‡∏õ‡πà‡∏≤‡∏°‡∏∞‡∏î‡∏±‡∏ô",
                        "‡∏Ç‡∏ô‡∏°‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏£‡∏∞‡∏¢‡∏≤‡∏Ñ‡∏π",
                        "‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡∏õ‡∏•‡∏≤‡∏Ñ‡∏±‡∏á",
                        "‡∏õ‡∏•‡∏≤‡∏î‡∏π‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£"
                    ]
                }
            },
            "winter": {
                "Chiang Mai": {
                    "places": [
                        "Doi Inthanon",
                        "‡∏î‡∏≠‡∏¢‡∏´‡∏•‡∏ß‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏î‡∏≤‡∏ß",
                        "‡∏ß‡∏±‡∏î‡∏≠‡∏∏‡πÇ‡∏°‡∏á‡∏Ñ‡πå (‡∏ß‡∏±‡∏î‡∏™‡∏ß‡∏ô‡∏û‡∏∏‡∏ó‡∏ò‡∏ò‡∏£‡∏£‡∏°)",
                        "‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡∏ò‡∏≤‡∏ï‡∏∏‡∏î‡∏≠‡∏¢‡∏Ñ‡∏≥",
                        "‡∏ß‡∏±‡∏î‡∏ï‡πâ‡∏ô‡πÄ‡∏Å‡∏ß‡πã‡∏ô"
                    ],
                    "menu": [
                        "‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏à‡∏≠",
                        "‡∏ô‡πâ‡∏≥‡∏û‡∏£‡∏¥‡∏Å‡∏´‡∏ô‡∏∏‡πà‡∏°",
                        "‡πÑ‡∏™‡πâ‡∏≠‡∏±‡πà‡∏ß",
                        "‡∏•‡∏≤‡∏ö‡∏Ñ‡∏±‡πà‡∏ß",
                        "‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏µ‡πâ‡∏¢‡∏ß",
                        "‡∏à‡∏¥‡πâ‡∏ô‡∏™‡πâ‡∏°"
                    ]
                }
            }
        },
        "china": {
            "summer": {
                "‰∏â‰∫ö (Sanya)": {
                    "places": [
                        "‡∏´‡∏≤‡∏î‡∏ã‡∏±‡∏ô‡∏¢‡πà‡∏≤",
                        "‡∏≠‡πà‡∏≤‡∏ß‡∏´‡∏¢‡πà‡∏≤‡∏´‡∏•‡∏á",
                        "‡πÄ‡∏Å‡∏≤‡∏∞‡∏´‡∏ô‡∏≤‡∏ô‡∏ã‡∏≤‡∏ô",
                        "‡πÄ‡∏Ç‡∏ï‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏•‡∏¥‡∏á‡πÄ‡∏Å‡∏≤‡∏∞‡∏•‡∏π‡πà‡∏´‡∏∏‡πà‡∏¢‡πÇ‡∏ñ‡∏ß"
                    ],
                    "menu": [
                        "Ê§∞Â∞èÈ∏° (‡πÑ‡∏Å‡πà‡∏ï‡πâ‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß)",
                        "Ê§∞Â≠êÈ•≠ (‡∏Ç‡πâ‡∏≤‡∏ß‡∏≠‡∏ö‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß)",
                        "Èòø‰∏âÈùìÊ±§ (‡∏ã‡∏∏‡∏õ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏™‡∏≤‡∏ô)",
                        "ËôæÈ•º (‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏Å‡∏∏‡πâ‡∏á)"
                    ]
                }
            },
            "rainy": {
                "‰∫ëÂçó-ÊòÜÊòé„ÄÅÂ§ßÁêÜ (Kunming/Dali)": {
                    "places": [
                        "‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡πÄ‡∏ï‡∏µ‡∏¢‡∏ô‡∏â‡∏∑‡∏≠",
                        "‡πÄ‡∏Ç‡∏≤‡∏´‡∏¥‡∏°‡∏∞‡∏°‡∏±‡∏á‡∏Å‡∏£‡∏´‡∏¢‡∏Å",
                        "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÇ‡∏ö‡∏£‡∏≤‡∏ì‡∏ï‡πâ‡∏≤‡∏´‡∏•‡∏µ‡πà"
                    ],
                    "menu": [
                        "È≤úËä±È•º (‡∏Ç‡∏ô‡∏°‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ)",
                        "ÊâãÊäìÈ•≠ (‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏∑‡∏≠)",
                        "ËøáÊ°•Á±≥Á∫ø (‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡∏™‡∏∞‡∏û‡∏≤‡∏ô)",
                        "ÂåÖÊµÜË±ÜËÖê (‡πÄ‡∏ï‡πâ‡∏≤‡∏´‡∏π‡πâ‡∏ï‡∏∏‡πã‡∏ô)"
                    ]
                }
            },
            "winter": {
                "ÈªëÈæôÊ±ü-ÂìàÂ∞îÊª® (Harbin)": {
                    "places": [
                        "‡πÄ‡∏ó‡∏®‡∏Å‡∏≤‡∏•‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏Æ‡∏≤‡∏£‡πå‡∏ö‡∏¥‡∏ô",
                        "‡πÄ‡∏Å‡∏≤‡∏∞‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞",
                        "‡∏™‡∏ß‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏´‡∏¥‡∏°‡∏∞"
                    ],
                    "menu": [
                        "ÈîÖÂåÖËÇâ (‡∏´‡∏°‡∏π‡∏ä‡∏∏‡∏ö‡πÅ‡∏õ‡πâ‡∏á‡∏ó‡∏≠‡∏î)",
                        "ÊùÄÁå™Ëèú (‡∏ã‡∏∏‡∏õ‡∏´‡∏°‡∏π)",
                        "ÂìàÂ∞îÊª®ÁÜèÈ∏° (‡πÑ‡∏Å‡πà‡∏£‡∏°‡∏Ñ‡∏ß‡∏±‡∏ô‡∏Æ‡∏≤‡∏£‡πå‡∏ö‡∏¥‡∏ô)",
                        "ÈìÅÈîÖÁÉÄÈ•º (‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏Æ‡∏≤‡∏£‡πå‡∏ö‡∏¥‡∏ô)"
                    ]
                }
            }
        }
    }
}

@app.route("/callback", methods=['POST'])
def callback():
    signature = request.headers['X-Line-Signature']
    body = request.get_data(as_text=True)
    app.logger.info("Request body: " + body)

    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)

    return 'OK'

@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    user_id = event.source.user_id
    user_msg = event.message.text.strip().lower()

    if user_id not in user_state:
        user_state[user_id] = {"step": 0, "category": None, "country": None, "season": None}

    state = user_state[user_id]

    if user_msg == "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà" or user_msg == "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥":
        state.update({"step": 0, "category": None, "country": None, "season": None})
        reply_text = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà! ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏∞‡πÑ‡∏£: ‡πÄ‡∏û‡∏•‡∏á, ‡∏´‡∏ô‡∏±‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß?"
        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=reply_text))
        return

    if state["step"] == 0:
        if "‡πÄ‡∏û‡∏•‡∏á" in user_msg:
            state["category"] = "music"
            reply_text = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®: ‡πÑ‡∏ó‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏à‡∏µ‡∏ô?"
            state["step"] = 1
        elif "‡∏´‡∏ô‡∏±‡∏á" in user_msg:
            state["category"] = "movie"
            reply_text = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®: ‡πÑ‡∏ó‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏à‡∏µ‡∏ô?"
            state["step"] = 1
        elif "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß" in user_msg:
            state["category"] = "travel"
            reply_text = "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÉ‡∏î: ‡πÑ‡∏ó‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏à‡∏µ‡∏ô?"
            state["step"] = 1
        else:
            reply_text = "‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏: ‡πÄ‡∏û‡∏•‡∏á, ‡∏´‡∏ô‡∏±‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß"
        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=reply_text))
        return

    if state["step"] == 1:
        category = state["category"]
        if category == "music":
            if "‡πÑ‡∏ó‡∏¢" in user_msg:
                state["country"] = "thai"
                reply_text = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏û‡∏•‡∏á: top hits, tpop, rock band ‡∏´‡∏£‡∏∑‡∏≠ folk song?"
                state["step"] = 2
            elif "‡∏à‡∏µ‡∏ô" in user_msg:
                state["country"] = "china"
                reply_text = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏û‡∏•‡∏á: cpop, ost ‡∏´‡∏£‡∏∑‡∏≠ tiktok hits?"
                state["step"] = 2
            else:
                reply_text = "‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®: ‡πÑ‡∏ó‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏à‡∏µ‡∏ô"
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=reply_text))
            return

        elif category == "movie":
            if "‡πÑ‡∏ó‡∏¢" in user_msg:
                state["country"] = "thai"
                reply_text = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏ô‡∏±‡∏á: animation, series ‡∏´‡∏£‡∏∑‡∏≠ movie?"
                state["step"] = 2
            elif "‡∏à‡∏µ‡∏ô" in user_msg:
                state["country"] = "china"
                reply_text = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏ô‡∏±‡∏á: animation, series ‡∏´‡∏£‡∏∑‡∏≠ movie?"
                state["step"] = 2
            else:
                reply_text = "‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®: ‡πÑ‡∏ó‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏à‡∏µ‡∏ô"
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=reply_text))
            return

        elif category == "travel":
            if "‡πÑ‡∏ó‡∏¢" in user_msg:
                state["country"] = "thai"
                reply_text = "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏§‡∏î‡∏π‡πÉ‡∏î: ‡∏£‡πâ‡∏≠‡∏ô, ‡∏ù‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏ô‡∏≤‡∏ß?"
                state["step"] = 2
            elif "‡∏à‡∏µ‡∏ô" in user_msg:
                state["country"] = "china"
                reply_text = "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏§‡∏î‡∏π‡πÉ‡∏î: ‡∏£‡πâ‡∏≠‡∏ô, ‡∏ù‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏ô‡∏≤‡∏ß?"
                state["step"] = 2
            else:
                reply_text = "‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®: ‡πÑ‡∏ó‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏à‡∏µ‡∏ô"
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=reply_text))
            return

    if state["step"] == 2:
        category = state["category"]
        country = state.get("country")

        if category == "music":
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏û‡∏•‡∏á
            if user_msg in data["music"][country]:
                items = "\n".join(f"- {item}" for item in data["music"][country][user_msg])
                # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
                all_categories = ", ".join(data["music"][country].keys())
                reply_text = (
                    f"‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î {user_msg}:\n{items}\n\n"
                    f"‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÄ‡∏û‡∏•‡∏á {country} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô {all_categories}\n"
                    f"‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏¥‡∏°‡∏û‡πå '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà' ‡∏´‡∏£‡∏∑‡∏≠ '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'"
                )
            else:
                reply_text = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ\n‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà"

            # ‡πÑ‡∏°‡πà reset step ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=reply_text))
            return

        elif category == "movie":
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏ô‡∏±‡∏á
            if user_msg in data["movie"][country]:
                items = "\n".join(f"- {item}" for item in data["movie"][country][user_msg])
                all_categories = ", ".join(data["movie"][country].keys())
                reply_text = (
                    f"‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î {user_msg}:\n{items}\n\n"
                    f"‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏ô‡∏±‡∏á {country} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô {all_categories}\n"
                    f"‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏¥‡∏°‡∏û‡πå '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà' ‡∏´‡∏£‡∏∑‡∏≠ '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'"
                )
            else:
                reply_text = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ\n‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà"

            # ‡πÑ‡∏°‡πà reset step ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=reply_text))
            return

        elif category == "travel":
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏§‡∏î‡∏π
            season_map = {"‡∏£‡πâ‡∏≠‡∏ô": "summer", "‡∏ù‡∏ô": "rainy", "‡∏´‡∏ô‡∏≤‡∏ß": "winter"}
            if user_msg in season_map:
                state["season"] = season_map[user_msg]
                reply_text = f"‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏§‡∏î‡∏π{user_msg}‡πÉ‡∏ô {state['country'].capitalize()}..."
                for province, details in data["travel"][state["country"]][state["season"]].items():
                    places = "\n".join(f"- {place}" for place in details["places"])
                    menu = "\n".join(f"- {dish}" for dish in details["menu"])
                    message = f"üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡πÄ‡∏°‡∏∑‡∏≠‡∏á: {province}\n\nüèûÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß:\n{places}\n\nüç¥ ‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:\n{menu}"
                    line_bot_api.push_message(user_id, TextSendMessage(text=message))
                
                # ‡πÅ‡∏™‡∏î‡∏á‡∏§‡∏î‡∏π‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                all_seasons = ", ".join(season_map.keys())
                reply_text += (
                    f"\n‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏§‡∏î‡∏π{user_msg}!\n"
                    f"‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏§‡∏î‡∏π‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® {state['country']} ‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô {all_seasons}\n"
                    f"‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏¥‡∏°‡∏û‡πå '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà' ‡∏´‡∏£‡∏∑‡∏≠ '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'"
                )
            else:
                reply_text = "‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏§‡∏î‡∏π: ‡∏£‡πâ‡∏≠‡∏ô, ‡∏ù‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏ô‡∏≤‡∏ß\n‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏¥‡∏°‡∏û‡πå '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà' ‡∏´‡∏£‡∏∑‡∏≠ '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'"

            # ‡πÑ‡∏°‡πà reset step ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏§‡∏î‡∏π‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=reply_text))
            return


if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    app.run(host="0.0.0.0", port=port)